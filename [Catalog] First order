select 
    usf.campaign_uuid,
    count(distinct o.id),
    avg(o.total)
from orders_order o
    left join user_store_userstorefirstdelivery usu on o.uuid = usu.order_uuid
    left join user_store_firstdeliveryredemption usf on usu.order_uuid = usf.order_uuid
where 1=1
    and usf.campaign_uuid = 'd1337462-713f-4581-8fa7-19030eaeb031'
    [[and o.created >= {{desde}} - interval '2 day']]
    [[and o.created < {{hasta}} + interval '2 day']]
    [[and o.created at time zone 'America/Mexico_City' >= {{desde}}]]
    [[and o.created at time zone 'America/Mexico_City' < {{hasta}} + interval '1 day']]
    and o.status = 'DELIVERED'
    and o.order_kind = 'NORMAL' 
    and o.currency = 'MXN'
GROUP BY 1;
