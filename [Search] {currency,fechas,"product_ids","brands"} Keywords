select
    cl.name as category_name,
    b.name as brand_name,
    p.id as product_id,
    p.name as product_name,
    psc.search_term,
    count(psc.search_term) as searches,
    count(distinct psc.user_id) as users,
    count(psc.search_term)*1.00 / count(distinct psc.user_id) as searches_p_user
from search_productsearchconversion psc 
    join catalog_product p on p.id = psc.product_id 
    join catalog_brand b on b.id = p.brand_id
    join catalog_category c on c.id = p.category_id
    join catalog_categorylocalization cl on cl.category_id = c.id
where 1=1
    [[and psc.search_term ~* {{search_terms}}]] --must be separated by "|"
    [[and p.id in ({{products_id}})]] --must be separated by comma ","
    [[and b.name ~* {{brand_names}}]] --must be separated by pipe "|"
    [[and cl.name ~* {{categories_names}}]] --must be separated by pipe "|"
    and cl.language = 'en'
    and p.currency = 'MXN'
    and psc.created > now() - interval '6 months'
group by 1,2,3,4,5
order by 6 desc;
