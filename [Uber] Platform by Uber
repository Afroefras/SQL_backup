select
	o.id order_id,
	case when o.uber_user_agent ilike '%eat%' then 'Uber Eats'
		 when o.uber_user_agent is null or o.uber_user_agent = 'unknown' then 'Unknown'
		 else 'Uber Ride' end as uber_platform
from orders_order o
    left join catalog_storebranch sb on o.shopper_store_branch_id = sb.id
    left join geo_city gc on sb.city_id = gc.id
    left join crm_users_view u on o.user_id = u.id
where 1=1
	and o.status = 'DELIVERED' and o.order_kind = 'NORMAL'
	and (o.platform = 0 and (o.client_bundle like '%uber%' or (o.client_bundle is null and u.tmp_uber_original_segmentation = 'Uber'))) --Uber Platform
	and o.actual_delivery_time >= date_trunc('week', current_date - 7)
	and (o.actual_delivery_time at time zone gc.timezone)::date between (current_date - 7) and (current_date - 1)
limit 2
