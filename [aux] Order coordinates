select
    ad.city,
    ad.lat,
    ad.lng,
    count(distinct ad.order_id) as orders
from orders_orderaddress ad
    join orders_order o on o.id = ad.order_id
where 1=1
    and o.actual_delivery_time >= {{desde}} - interval '1 day'
    and o.actual_delivery_time < {{hasta}} + interval '2 day'
    and o.currency = 'MXN'
    and o.status = 'DELIVERED'
    and o.order_kind = 'NORMAL'
    and ad.city ~* 'ciudad de mÃ©xico|monterrey' group by 1,2,3;
